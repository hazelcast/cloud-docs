= Send Logs to Amazon OpenSearch
:description: In this tutorial, you'll set up an Amazon OpenSearch domain and configure your Hazelcast Cloud cluster to automatically send log files to it. You'll also learn how to view these logs in Kibana.
:url-github-elasticsearch: https://github.com/elastic/elasticsearch
:url-amazon-opensearch: https://aws.amazon.com/opensearch-service
:url-aws-signup: https://portal.aws.amazon.com/billing/signup 
:url-aws-console: https://us-west-2.console.aws.amazon.com/es/home
:page-dedicated: true

{description}

== Context

link:{url-amazon-elasticsearch}[Amazon OpenSearch Service] is based on link:{url-github-elasticsearch}[Elasticsearch], and allows you to search, analyze and visualize your cluster logs using Kibana.

[[step-one]]
== Step 1. Create an Amazon OpenSearch Domain

Set up an Amazon OpenSearch domain to receive log files from your Hazelcast Cloud cluster and send them to Kibana.

. link:{url-aws-signup}[Create an AWS account] if you don't have one already.
. Sign in as root user.
. From the list of regions on the top menu, select *US West (N California) us-west-1*.
// Does the domain need to be in a specific region?
. Search for and select *Amazon OpenSearch Service*. The Dashboard opens ready for you to start configuration.
+
image:aws-openservice-dashboard.png[Dashboard for Amazon OpenSearch Service]
. Click *Create domain*.
. On the *Create domain* page, only update the following settings. 
* *Name* section
** In the *Domain name* field, enter a short name for the OpenSearch domain. For example, _hazelcast-cloud-logs_.

* *Deployment type* section
** For testing purposes, select *Development and testing* as the deployment type. Don't worry, you can adjust your settings later for Production needs.
** From the *Version* list, select *Elasticsearch* > *7.10*.
// Is this correct or should we use the latest OpenSearch version?

* *Data nodes* section
** Under *Availability Zones*, select *1-AZ*.

* *Network* section
** Select *Public access* to use fine-grained access control to secure the OpenSearch domain and data. VPC Peering connections between Hazelcast Cloud clusters and OpenSearch instances are not currently supported.
// Is this still true? 

* *Fine-grained access control* section
** Select *Create Master User* and enter a username and password for the account.

+
+
TIP: Make a note of the master user credentials. You'll need them later to access Kibana, and to make any configuration changes to your OpenSearch domain.
+

* *Access policy* section
** Select *Only use fine-grained access control*.

+
That's all the configuration that you need to do for now.

. Click *Create* to build your domain. You'll need to wait up to 10 minutes while your OpenSearch environment and the following URLs are created. You need both URLs for the next steps.

** *Kibana URL*
** *Domain endpoint*

. When the domain creation process reaches 100%, refresh the page. Make sure that your domain is active before you continue to the next step.


[[step-two]]
== Step 2. Configure a Logging Integration in Hazelcast Cloud

Configure your Hazelcast Dedicated cluster to send log files to the OpenSearch domain.

You'll need the master user credentials and domain endpoint that you created in xref:#step-one[Step 1].

. In Hazelcast Cloud, go to *Your Clusters* and select the cluster that want to integrate with OpenSearch.
. Select *Manage Cluster* > *Settings*, and on the *Cluster Settings* page select *Logging*.
. From the *Logging Technology* list, select *Elastic Stack (ELK)*.
. In the *Username* and *Password* fields, enter your master user credentials.
. In the *URL* field, enter the domain endpoint for your OpenSearch domain followed by port number 443. 
+ 
For example: `https://search-<domain-name>-lxxxxxxx3f2v3wz3tlkh4.us-west-1.es.amazonaws.com:443`
+
OpenSearch supports HTTPS over port 443.

. Click *Create Integration*. Within 30 seconds, Hazelcast starts to send log files to OpenSearch, which are made available in Kibana.

== Step 3. Set Up a Kibana Dashboard

Set up an index pattern to load the logs received from OpenSearch into a Kibana dashboard. 

You'll need the master user credentials and Kibana URL that you created in xref:#step-one[Step 1].

[NOTE]
====
To create log data for viewing, make sure that:

* Your Hazelcast Cloud cluster is running 
* A client is writing data to the cluster.
====

. From your domain details page in OpenSearch, click on the *Kibana URL*.
. Log in to Kibana using your master user credentials.
. Select *Explore on my own* to skip onboarding.
. From the *Select tenant* dialog box, select *Private* and click *Confirm*.
. From the main menu, select *Kibana* > *Discover* to start your set up.
. Click *Create index pattern*. An index pattern tells Kibana which indices contain the data that you want to view.
. In the *Index pattern* field, enter a wildcard `*` to find all log data received from OpenSearch. 
. When Kibana finds the Hazelcast Cloud logs, click *Next step*.
. From the *Time field* list, select *updated_at* so that you'll be able to filter your log file data by time.
. Click *Create index pattern*. Your log file data is ready to view. Simply select *Kibana* > *Discover* from the main menu.

+
image:kibana-dashboard.png[Log data in Kibana Dashboard]

If necessary, you can now return to your OpenServe domain and increase the number of nodes or availability zones to add resilience to the logging service.

== Summary

In this tutorial, you learned how to do the following:

* Create an Amazon OpenSearch domain to receive log files from your Hazelcast Cloud cluster.
* Configure your Hazelcast Dedicated cluster to automatically send log files to the OpenSearch domain.
* Load log files into a Kibana dashboard using an index pattern.